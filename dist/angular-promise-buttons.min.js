angular.module("angularPromiseButtons",[]),angular.module("angularPromiseButtons").directive("promiseBtn",["angularPromiseButtons","$compile","$parse","$timeout",function(a,b,c,d){"use strict";var e="click",f="ngClick",g="submit",h="ngSubmit";return{restrict:"EA",priority:a.config.priority,scope:{promiseBtn:"=",promiseBtnOptions:"=?"},link:function(i,j,k){function l(a){z.btnLoadingClass&&!z.addClassToCurrentBtnOnly&&a.addClass(z.btnLoadingClass),z.disableBtn&&!z.disableCurrentBtnOnly&&a.attr("disabled","disabled"),z.btnLoadingHtml&&(a.html(z.btnLoadingHtml),s(a))}function m(a,b,c){o(a),c.handlerFunction&&"function"==typeof c.handlerFunction&&c.handlerFunction(),z.onComplete&&"function"==typeof z.onComplete&&z.onComplete();var e=0;return c&&c.resultWaitTime&&c.resultWaitTime>=0&&(e=c.resultWaitTime),e&&n(a,c),x=d(function(){p(a,b,c)},e)}function n(a,b){b&&(b.resultHtml&&a.html(b.resultHtml),b.resultCssClass&&a.addClass(b.resultCssClass))}function o(a){z.btnLoadingClass&&a.removeClass(z.btnLoadingClass)}function p(a,b,c){z.disableBtn&&a.removeAttr("disabled"),b&&a.html()!=b&&a.html(b),c&&c.resultCssClass&&a.removeClass(c.resultCssClass)}function q(a,b){i.$watch(a,function(a){var c=null;if(a&&a.then?c=a:a&&a.$promise&&(c=a.$promise),c){var d=z.defaultHtml||b.html();l(b),c.then(function(){m(b,d,z.onSuccessConfig)},function(){m(b,d,z.onErrorConfig)})}})}function r(a){return a.split(";").map(function(a){return c(a)})}function s(a){a.append(b(z.spinnerTpl)(i))}function t(a){z.addClassToCurrentBtnOnly&&a.on(e,function(){a.addClass(z.btnLoadingClass)}),z.disableCurrentBtnOnly&&a.on(e,function(){a.attr("disabled","disabled")})}function u(a,b,c){i.$evalAsync(function(){var d=r(k[b]);j.unbind(a),j.bind(a,function(){i.$apply(function(){d.forEach(function(b){var d=b(i.$parent,{$event:a});w||(w=q(function(){return d},c))})})})})}function v(a){for(var b=[],c=a.find("button"),d=0;d<c.length;d++){var e=c[d];"submit"===angular.element(e).attr("type")&&b.push(e)}return angular.element(b)}var w,x,y=a.config,z=y;if(k.promiseBtn)s(j),t(j),q(function(){return i.promiseBtn},j);else if(k.hasOwnProperty(f))s(j),t(j),u(e,f,j);else if(k.hasOwnProperty(h)){var A=v(j);s(A),t(A),u(g,h,A)}i.$watch("promiseBtnOptions",function(a){angular.isObject(a)&&(z=angular.extend({},y,a))},!0),i.$on("$destroy",function(a){d.cancel(x)})}}}]),angular.module("angularPromiseButtons").provider("angularPromiseButtons",function(){"use strict";var a={spinnerTpl:'<span class="btn-spinner"></span>',priority:0,disableBtn:!0,btnLoadingClass:"is-loading",btnLoadingHtml:null,addClassToCurrentBtnOnly:!1,disableCurrentBtnOnly:!1,defaultHtml:null,onComplete:null,onSuccessConfig:{handlerFunction:null,resultWaitTime:0,resultHtml:"Success",resultCssClass:"loading-success"},onErrorConfig:{handlerFunction:null,resultWaitTime:0,resultHtml:"Error",resultCssClass:"loading-error"}};return{extendConfig:function(b){a=angular.extend(a,b)},$get:function(){return{config:a}}}});