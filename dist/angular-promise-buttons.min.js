angular.module("angularPromiseButtons",[]),angular.module("angularPromiseButtons").directive("promiseBtn",["angularPromiseButtons","$parse","$timeout","$compile",function(a,b,c,d){"use strict";return{restrict:"EA",priority:a.config.priority,scope:{promiseBtn:"=",promiseBtnOptions:"=?"},link:function(e,f,g){function h(a){t.btnLoadingClass&&!t.addClassToCurrentBtnOnly&&a.addClass(t.btnLoadingClass),t.disableBtn&&!t.disableCurrentBtnOnly&&a.attr("disabled","disabled")}function i(a){t.minDuration&&!r||!s||(t.btnLoadingClass&&a.removeClass(t.btnLoadingClass),t.disableBtn&&a.removeAttr("disabled"))}function j(a,b){e.$watch(a,function(a){r=!1,s=!1,t.minDuration&&(q=c(function(){r=!0,i(b)},t.minDuration)),a&&a.then?(h(b),a.finally(function(){s=!0,i(b)})):a&&a.$promise&&(h(b),a.$promise.finally(function(){s=!0,i(b)}))})}function k(a){return a.split(";").map(function(a){return b(a)})}function l(a){a.append(d(t.spinnerTpl)(e))}function m(a){t.addClassToCurrentBtnOnly&&a.on(t.CLICK_EVENT,function(){a.addClass(t.btnLoadingClass)}),t.disableCurrentBtnOnly&&a.on(t.CLICK_EVENT,function(){a.attr("disabled","disabled")})}function n(a,b,c){e.$evalAsync(function(){var d=k(g[b]);f.unbind(a),f.bind(a,function(){e.$apply(function(){d.forEach(function(b){var d=b(e.$parent,{$event:a});p||(p=j(function(){return d},c))})})})})}function o(b){for(var c=[],d=b.find(a.config.BTN_SELECTOR),e=0;e<d.length;e++){var f=d[e];"submit"===angular.element(f).attr("type")&&c.push(f)}return angular.element(c)}var p,q,r,s,t=a.config;if(g.promiseBtn)l(f),m(f),j(function(){return e.promiseBtn},f);else if(g.hasOwnProperty(t.CLICK_ATTR))l(f),m(f),n(t.CLICK_EVENT,t.CLICK_ATTR,f);else if(g.hasOwnProperty(t.SUBMIT_ATTR)){var u=o(f);l(u),m(u),n(t.SUBMIT_EVENT,t.SUBMIT_ATTR,u)}e.$watch("promiseBtnOptions",function(a){angular.isObject(a)&&(t=angular.extend({},t,a))},!0),e.$on("$destroy",function(){c.cancel(q)})}}}]),angular.module("angularPromiseButtons").provider("angularPromiseButtons",function(){"use strict";var a={spinnerTpl:'<span class="btn-spinner"></span>',priority:0,disableBtn:!0,btnLoadingClass:"is-loading",addClassToCurrentBtnOnly:!1,disableCurrentBtnOnly:!1,minDuration:!1,CLICK_EVENT:"click",CLICK_ATTR:"ngClick",SUBMIT_EVENT:"submit",SUBMIT_ATTR:"ngSubmit",BTN_SELECTOR:"button"};return{extendConfig:function(b){a=angular.extend(a,b)},$get:function(){return{config:a}}}});