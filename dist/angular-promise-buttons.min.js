angular.module("angularPromiseButtons",[]),angular.module("angularPromiseButtons").directive("promiseBtn",["angularPromiseButtons","$parse","$timeout",function(a,b,c){"use strict";var d="click",e="ngClick",f="submit",g="ngSubmit";return{restrict:"EA",scope:{promiseBtn:"=",promiseBtnOptions:"=?"},link:function(h,i,j){function k(a){x.btnLoadingClass&&!x.addClassToCurrentBtnOnly&&a.addClass(x.btnLoadingClass),x.disableBtn&&!x.disableCurrentBtnOnly&&a.attr("disabled","disabled"),x.btnLoadingHtml&&a.html(x.btnLoadingHtml)}function l(a,b,d,e){n(a),m(a,e),d&&"function"==typeof d&&d(),x.onComplete&&"function"==typeof x.onComplete&&x.onComplete();var f=0;return e&&e.resultWaitTime&&e.resultWaitTime>=0&&(f=e.resultWaitTime),c(function(){o(a,b,e)},f)}function m(a,b){b&&(b.resultHtml&&a.html(b.resultHtml),b.resultCssClass&&a.addClass(b.resultCssClass))}function n(a){x.btnLoadingClass&&a.removeClass(x.btnLoadingClass)}function o(a,b,c){x.disableBtn&&a.removeAttr("disabled"),b&&a.html(b),c&&c.resultCssClass&&a.removeClass(c.resultCssClass)}function p(a,b){h.$watch(a,function(a){var c=null;if(a&&a.then?c=a:a&&a.$promise&&(c=a.$promise),c){var d=x.defaultHtml||b.html();k(b),c.then(function(){l(b,d,x.onSuccess,x.onSuccessConfig)},function(){l(b,d,x.onError,x.onErrorConfig)})}})}function q(a){return a.split(";").map(function(a){return b(a)})}function r(a){a.append(x.spinnerTpl)}function s(a){x.addClassToCurrentBtnOnly&&a.on(d,function(){a.addClass(x.btnLoadingClass)}),x.disableCurrentBtnOnly&&a.on(d,function(){a.attr("disabled","disabled")})}function t(a,b,c){h.$evalAsync(function(){var d=q(j[b]);i.unbind(a),i.bind(a,function(){h.$apply(function(){d.forEach(function(b){var d=b(h.$parent,{$event:a});v||(v=p(function(){return d},c))})})})})}function u(a){for(var b=[],c=a.find("button"),d=0;d<c.length;d++){var e=c[d];"submit"===angular.element(e).attr("type")&&b.push(e)}return angular.element(b)}var v,w=a.config,x=w;if(j.promiseBtn)r(i),s(i),p(function(){return h.promiseBtn},i);else if(j.hasOwnProperty(e))r(i),s(i),t(d,e,i);else if(j.hasOwnProperty(g)){var y=u(i);r(y),s(y),t(f,g,y)}h.$watch("promiseBtnOptions",function(a){angular.isObject(a)&&(x=angular.extend({},w,a))},!0)}}}]),angular.module("angularPromiseButtons").provider("angularPromiseButtons",function(){"use strict";var a={spinnerTpl:'<span class="btn-spinner"></span>',disableBtn:!0,btnLoadingClass:"is-loading",btnLoadingHtml:null,addClassToCurrentBtnOnly:!1,disableCurrentBtnOnly:!1,defaultHtml:null,onComplete:null,onSuccess:null,onError:null,onSuccessConfig:{resultWaitTime:0,resultHtml:"Success",resultCssClass:"loading-success"},onErrorConfig:{resultWaitTime:0,resultHtml:"Failure",resultCssClass:"loading-error"}};return{extendConfig:function(b){a=angular.extend(a,b)},$get:function(){return{config:a}}}});